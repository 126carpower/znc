CXX=g++
CXXFLAGS=@CXXFLAGS@
INCLUDES=@INCLUDES@
LIBS=@LIBS@
prefix=@prefix@

OBJS=String.o Csocket.o main.o znc.o User.o IRCSock.o UserSock.o DCCBounce.o DCCSock.o Chan.o Nick.o Server.o Modules.o MD5.o Buffer.o Utils.o FileUtils.o HTTPSock.o
SRCS=String.cpp Csocket.cpp main.cpp znc.cpp User.cpp IRCSock.cpp UserSock.cpp DCCBounce.cpp DCCSock.cpp Chan.cpp Nick.cpp Server.cpp Modules.cpp MD5.cpp Buffer.cpp Utils.cpp FileUtils.cpp HTTPSock.cpp

all: znc @MODTARGET@

depend::
	g++ -MM $(CXXFLAGS) $(SRCS) $(INCLUDES) >.depend
	(cd modules; $(MAKE) depend)

znc: $(OBJS)
	$(CXX) $(CXXFLAGS) $(INCLUDES) -o $@ $(LIBS) $(OBJS)

znc-static: $(OBJS)
	$(CXX) $(CXXFLAGS) -static -o $@ $(INCLUDES) $(OBJS) $(LIBS)
	strip $@

modules::
	(cd modules; $(MAKE) all)

clean:
	rm -rf znc znc-static *.o core core.*
	(cd modules; $(MAKE) clean)

distclean: clean
	rm -rf Makefile config.log config.status znc-config .depend modules/.depend modules/Makefile

-include .depend

%.o: %.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c -o $*.o $*.cpp

install: znc @MODTARGET@
	mkdir -p $(DESTDIR)$(prefix)/bin
	mkdir -p $(DESTDIR)$(prefix)/include/znc
	install -m 0755 znc $(DESTDIR)$(prefix)/bin
	install -m 0755 znc-config $(DESTDIR)$(prefix)/bin
	install -m 0755 znc-buildmod $(DESTDIR)$(prefix)/bin
	install -m 0644 *.h $(DESTDIR)$(prefix)/include/znc
	if test -n "@MODTARGET@"; then (cd modules; $(MAKE) install DESTDIR=$(DESTDIR)); fi
