CXX=@CXX@
CXXFLAGS=@CXXFLAGS@
LDFLAGS=@LDFLAGS@
INCLUDES=@INCLUDES@
LIBS=@LIBS@
prefix=@prefix@

OBJS=String.o Csocket.o main.o znc.o User.o IRCSock.o Client.o DCCBounce.o DCCSock.o Chan.o Nick.o Server.o Modules.o MD5.o Buffer.o Utils.o FileUtils.o HTTPSock.o Template.o
SRCS=String.cpp Csocket.cpp main.cpp znc.cpp User.cpp IRCSock.cpp Client.cpp DCCBounce.cpp DCCSock.cpp Chan.cpp Nick.cpp Server.cpp Modules.cpp MD5.cpp Buffer.cpp Utils.cpp FileUtils.cpp HTTPSock.cpp Template.cpp

all: znc @MODTARGET@

depend::
	$(CXX) -MM $(CXXFLAGS) $(SRCS) $(INCLUDES) >.depend
	@if test -n "@MODTARGET@"; then (cd modules; $(MAKE) depend); fi

znc: $(OBJS)
	$(CXX) $(CXXFLAGS) $(LDFLAGS) -o $@ $(INCLUDES) $(OBJS) $(LIBS)

znc-static: $(OBJS)
	$(CXX) $(CXXFLAGS) $(LDFLAGS) -static -o $@ $(INCLUDES) $(OBJS) $(LIBS)
	strip $@

modules::
	@if test -n "@MODTARGET@"; then (cd modules; $(MAKE) all); else echo "Modules are not enabled"; fi

clean:
	rm -rf znc znc-static *.o core core.*
	@if test -n "@MODTARGET@"; then (cd modules; $(MAKE) clean); fi

distclean: clean
	rm -rf Makefile config.log config.status znc-config .depend modules/.depend modules/Makefile

-include .depend

%.o: %.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c -o $*.o $*.cpp

install: znc @MODTARGET@
	mkdir -p $(DESTDIR)$(prefix)/bin
	mkdir -p $(DESTDIR)$(prefix)/include/znc
	install -m 0755 znc $(DESTDIR)$(prefix)/bin
	install -m 0755 znc-config $(DESTDIR)$(prefix)/bin
	install -m 0755 znc-buildmod $(DESTDIR)$(prefix)/bin
	install -m 0644 *.h $(DESTDIR)$(prefix)/include/znc
	if test -n "@MODTARGET@"; then (cd modules; $(MAKE) install DESTDIR=$(DESTDIR)); fi
