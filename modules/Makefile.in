prefix=@prefix@
CXX=g++
CXXFLAGS=@CXXFLAGS@
INCLUDES=@INCLUDES@ -I..
LIBS=@LIBS@
VPATH=.:..
OBJS=$(addsuffix .o, $(basename $(wildcard *.cpp)))
SRCS=$(wildcard *.cpp) $(wildcard ../*.cpp)
INSTALL_TARGS=$(foreach file, $(addsuffix .so, $(basename $(wildcard *.cpp))), install_$(file))

all: $(OBJS) $(addsuffix .so, $(basename $(wildcard *.cpp)))

depend::
	g++ -M $(CXXFLAGS) $(SRCS) $(INCLUDES) >.depend

install: all create_install_dir $(INSTALL_TARGS)
	install -m 0711 *.so $(DEST)$(prefix)/share/znc

create_install_dir:
	mkdir -p $(DEST)$(prefix)/share/znc

install_%:
	install -m 0711 $(subst install_,,$@) $(DEST)$(prefix)/share

clean:
	rm -rf *.so *.o core core.*

-include .depend

%.so: %.o
	$(CXX) $(CXXFLAGS) -shared -o $@ $< $(INCLUDES) $(LIBS)

%.o: %.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c -o $@ $<
